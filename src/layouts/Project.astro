---
import Base from "./Base.astro";
import PostContent from "src/components/blog/post/PostContent.astro";
import HighlightList from "src/components/HighlightList.astro";
import { CollectionEntry, getCollection } from "astro:content";

type Props = CollectionEntry<"projects">;

const { data: frontmatter, id, render } = Astro.props;

const tags = frontmatter.tags || [];
const posts = (
  await getCollection(
    "blog",
    (p) => !p.data.draft && tags.some((t) => p.data.tags?.includes(t))
  )
).sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const { Content } = await render();
---

<Base
  path={"resume/projects/" + id}
  back="/resume"
  title={frontmatter.name}
  description={frontmatter.description}
>
  <article>
    <h1>{frontmatter.name}</h1>
    <PostContent>
      <Content />
    </PostContent>

    {
      posts.length > 0 ? (
        <>
          <h2>Related blog posts</h2>
          <HighlightList highlights={posts} />
        </>
      ) : null
    }
  </article>
</Base>

<style lang="scss">
  @import "/src/variables.scss";
  article {
    width: 95%;
    max-width: 75ch;
    padding: 20px;
    @media print {
      width: 100%;
      max-width: 100%;
    }
    // margin: 1rem 2rem;
  }
</style>
